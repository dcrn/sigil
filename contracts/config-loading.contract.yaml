id: config-loading
version: "1.0.0"
name: Configuration Loading
description: >
  The MCP server reads its configuration from a cdd.config.yaml file in
  the project root. This file specifies the contracts directory path, the
  regex pattern used to find test annotations, and the directories to scan
  for tests. If the config file is missing, the server uses sensible
  defaults (contracts_dir: "contracts/", default test link pattern, no
  test dirs). If the config file exists but is malformed, the server
  reports a clear error and refuses to start.

priority: must
domain: core
tags: [config, startup]

refs:
  - cdd.config.yaml

behaviors:
  - id: load-from-file
    description: >
      On startup, the server reads cdd.config.yaml from the project root
      and uses its values for contracts_dir, test_link_pattern, and test_dirs.
    refs:
      - cdd.config.yaml
    constraints:
      - contracts_dir must be treated as relative to the project root
      - test_link_pattern must be a valid regex; invalid patterns cause a startup error
      - test_dirs entries may contain glob patterns

  - id: defaults-when-missing
    description: >
      If cdd.config.yaml does not exist, the server starts with default
      configuration values rather than failing.
    constraints:
      - Default contracts_dir is "contracts/"
      - Default test_link_pattern is 'fulfills-contract\("([^"]+)"\)'
      - Default test_dirs is empty (no test scanning until configured)

  - id: error-on-malformed
    description: >
      If cdd.config.yaml exists but contains invalid YAML or unrecognized
      fields, the server reports a clear error.
    constraints:
      - The error message must identify what is wrong with the config
      - The server must not start with a partially-parsed config
